import{b1 as e}from"./index-Bk8j52k6.mjs";import{P as t,F as r,S as n,T as o,N as i,D as s,a as l,b as a}from"./tiptap-pm-entry-C1u8SbQo.mjs";class c extends a{constructor(e){super(e,e)}map(e,t){let r=e.resolve(t.map(this.head));return c.valid(r)?new c(r):a.near(r)}content(){return n.empty}eq(e){return e instanceof c&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,t){if("number"!=typeof t.pos)throw new RangeError("Invalid input for GapCursor.fromJSON");return new c(e.resolve(t.pos))}getBookmark(){return new u(this.anchor)}static valid(e){let t=e.parent;if(t.isTextblock||!function(e){for(let t=e.depth;t>=0;t--){let r=e.index(t),n=e.node(t);if(0!=r)for(let e=n.child(r-1);;e=e.lastChild){if(0==e.childCount&&!e.inlineContent||d(e.type))return!0;if(e.inlineContent)return!1}else if(n.type.spec.isolating)return!0}return!0}(e)||!function(e){for(let t=e.depth;t>=0;t--){let r=e.indexAfter(t),n=e.node(t);if(r!=n.childCount)for(let e=n.child(r);;e=e.firstChild){if(0==e.childCount&&!e.inlineContent||d(e.type))return!0;if(e.inlineContent)return!1}else if(n.type.spec.isolating)return!0}return!0}(e))return!1;let r=t.type.spec.allowGapCursor;if(null!=r)return r;let n=t.contentMatchAt(e.index()).defaultType;return n&&n.isTextblock}static findGapCursorFrom(e,t,r=!1){e:for(;;){if(!r&&c.valid(e))return e;let n=e.pos,o=null;for(let r=e.depth;;r--){let i=e.node(r);if(t>0?e.indexAfter(r)<i.childCount:e.index(r)>0){o=i.child(t>0?e.indexAfter(r):e.index(r)-1);break}if(0==r)return null;n+=t;let s=e.doc.resolve(n);if(c.valid(s))return s}for(;;){let s=t>0?o.firstChild:o.lastChild;if(!s){if(o.isAtom&&!o.isText&&!i.isSelectable(o)){e=e.doc.resolve(n+o.nodeSize*t),r=!1;continue e}break}o=s,n+=t;let l=e.doc.resolve(n);if(c.valid(l))return l}return null}}}c.prototype.visible=!1,c.findFrom=c.findGapCursorFrom,a.jsonID("gapcursor",c);class u{constructor(e){this.pos=e}map(e){return new u(e.map(this.pos))}resolve(e){let t=e.resolve(this.pos);return c.valid(t)?new c(t):a.near(t)}}function d(e){return e.isAtom||e.spec.isolating||e.spec.createGapCursor}function f(){return new t({props:{decorations:w,createSelectionBetween:(e,t,r)=>t.pos==r.pos&&c.valid(r)?new c(r):null,handleClick:m,handleKeyDown:p,handleDOMEvents:{beforeinput:v}}})}const p=e({ArrowLeft:h("horiz",-1),ArrowRight:h("horiz",1),ArrowUp:h("vert",-1),ArrowDown:h("vert",1)});function h(e,t){const r="vert"==e?t>0?"down":"up":t>0?"right":"left";return function(e,n,i){let s=e.selection,l=t>0?s.$to:s.$from,a=s.empty;if(s instanceof o){if(!i.endOfTextblock(r)||0==l.depth)return!1;a=!1,l=e.doc.resolve(t>0?l.after():l.before())}let u=c.findGapCursorFrom(l,t,a);return!!u&&(n&&n(e.tr.setSelection(new c(u))),!0)}}function m(e,t,r){if(!e||!e.editable)return!1;let n=e.state.doc.resolve(t);if(!c.valid(n))return!1;let o=e.posAtCoords({left:r.clientX,top:r.clientY});return!(o&&o.inside>-1&&i.isSelectable(e.state.doc.nodeAt(o.inside)))&&(e.dispatch(e.state.tr.setSelection(new c(n))),!0)}function v(e,t){if("insertCompositionText"!=t.inputType||!(e.state.selection instanceof c))return!1;let{$from:i}=e.state.selection,s=i.parent.contentMatchAt(i.index()).findWrapping(e.state.schema.nodes.text);if(!s)return!1;let l=r.empty;for(let n=s.length-1;n>=0;n--)l=r.from(s[n].createAndFill(null,l));let a=e.state.tr.replace(i.pos,i.pos,new n(l,0,0));return a.setSelection(o.near(a.doc.resolve(i.pos+1))),e.dispatch(a),!1}function w(e){if(!(e.selection instanceof c))return null;let t=document.createElement("div");return t.className="ProseMirror-gapcursor",s.create(e.doc,[l.widget(e.selection.head,t,{key:"gapcursor"})])}export{c as G,f as g};

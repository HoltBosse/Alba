import{c as e,i as t,X as n,at as o,au as i}from"./index-Bk8j52k6.mjs";import{P as r,d as s,c as a,M as l,D as h,a as p}from"./tiptap-pm-entry-C1u8SbQo.mjs";import{g as d}from"./index-CKNipKJW.mjs";function c(e={}){return new r({view:t=>new u(t,e)})}class u{constructor(e,t){var n;this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=null!==(n=t.width)&&void 0!==n?n:1,this.color=!1===t.color?void 0:t.color||"black",this.class=t.class,this.handlers=["dragover","dragend","drop","dragleave"].map(t=>{let n=e=>{this[t](e)};return e.dom.addEventListener(t,n),{name:t,handler:n}})}destroy(){this.handlers.forEach(({name:e,handler:t})=>this.editorView.dom.removeEventListener(e,t))}update(e,t){null!=this.cursorPos&&t.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,null==e?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e,t=this.editorView.state.doc.resolve(this.cursorPos),n=!t.parent.inlineContent,o=this.editorView.dom,i=o.getBoundingClientRect(),r=i.width/o.offsetWidth,s=i.height/o.offsetHeight;if(n){let n=t.nodeBefore,o=t.nodeAfter;if(n||o){let t=this.editorView.nodeDOM(this.cursorPos-(n?n.nodeSize:0));if(t){let i=t.getBoundingClientRect(),r=n?i.bottom:i.top;n&&o&&(r=(r+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2);let a=this.width/2*s;e={left:i.left,right:i.right,top:r-a,bottom:r+a}}}}if(!e){let t=this.editorView.coordsAtPos(this.cursorPos),n=this.width/2*r;e={left:t.left-n,right:t.left+n,top:t.top,bottom:t.bottom}}let a,l,h=this.editorView.dom.offsetParent;if(this.element||(this.element=h.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",n),this.element.classList.toggle("prosemirror-dropcursor-inline",!n),!h||h==document.body&&"static"==getComputedStyle(h).position)a=-pageXOffset,l=-pageYOffset;else{let e=h.getBoundingClientRect(),t=e.width/h.offsetWidth,n=e.height/h.offsetHeight;a=e.left-h.scrollLeft*t,l=e.top-h.scrollTop*n}this.element.style.left=(e.left-a)/r+"px",this.element.style.top=(e.top-l)/s+"px",this.element.style.width=(e.right-e.left)/r+"px",this.element.style.height=(e.bottom-e.top)/s+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),e)}dragover(e){if(!this.editorView.editable)return;let t=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),n=t&&t.inside>=0&&this.editorView.state.doc.nodeAt(t.inside),o=n&&n.type.spec.disableDropCursor,i="function"==typeof o?o(this.editorView,t,e):o;if(t&&!i){let e=t.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let t=s(this.editorView.state.doc,e,this.editorView.dragging.slice);null!=t&&(e=t)}this.setCursor(e),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){this.editorView.dom.contains(e.relatedTarget)||this.setCursor(null)}}var m=200,f=function(){};f.prototype.append=function(e){return e.length?(e=f.from(e),!this.length&&e||e.length<m&&this.leafAppend(e)||this.length<m&&e.leafPrepend(this)||this.appendInner(e)):this},f.prototype.prepend=function(e){return e.length?f.from(e).append(this):this},f.prototype.appendInner=function(e){return new v(this,e)},f.prototype.slice=function(e,t){return void 0===e&&(e=0),void 0===t&&(t=this.length),e>=t?f.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,t))},f.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)},f.prototype.forEach=function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=this.length),t<=n?this.forEachInner(e,t,n,0):this.forEachInvertedInner(e,t,n,0)},f.prototype.map=function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=this.length);var o=[];return this.forEach(function(t,n){return o.push(e(t,n))},t,n),o},f.from=function(e){return e instanceof f?e:e&&e.length?new g(e):f.empty};var g=/* @__PURE__ */function(e){function t(t){e.call(this),this.values=t}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={length:{configurable:!0},depth:{configurable:!0}};return t.prototype.flatten=function(){return this.values},t.prototype.sliceInner=function(e,n){return 0==e&&n==this.length?this:new t(this.values.slice(e,n))},t.prototype.getInner=function(e){return this.values[e]},t.prototype.forEachInner=function(e,t,n,o){for(var i=t;i<n;i++)if(!1===e(this.values[i],o+i))return!1},t.prototype.forEachInvertedInner=function(e,t,n,o){for(var i=t-1;i>=n;i--)if(!1===e(this.values[i],o+i))return!1},t.prototype.leafAppend=function(e){if(this.length+e.length<=m)return new t(this.values.concat(e.flatten()))},t.prototype.leafPrepend=function(e){if(this.length+e.length<=m)return new t(e.flatten().concat(this.values))},n.length.get=function(){return this.values.length},n.depth.get=function(){return 0},Object.defineProperties(t.prototype,n),t}(f);f.empty=new g([]);var v=/* @__PURE__ */function(e){function t(t,n){e.call(this),this.left=t,this.right=n,this.length=t.length+n.length,this.depth=Math.max(t.depth,n.depth)+1}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},t.prototype.getInner=function(e){return e<this.left.length?this.left.get(e):this.right.get(e-this.left.length)},t.prototype.forEachInner=function(e,t,n,o){var i=this.left.length;return!(t<i&&!1===this.left.forEachInner(e,t,Math.min(n,i),o))&&(!(n>i&&!1===this.right.forEachInner(e,Math.max(t-i,0),Math.min(this.length,n)-i,o+i))&&void 0)},t.prototype.forEachInvertedInner=function(e,t,n,o){var i=this.left.length;return!(t>i&&!1===this.right.forEachInvertedInner(e,t-i,Math.max(n,i)-i,o+i))&&(!(n<i&&!1===this.left.forEachInvertedInner(e,Math.min(t,i),n,o))&&void 0)},t.prototype.sliceInner=function(e,t){if(0==e&&t==this.length)return this;var n=this.left.length;return t<=n?this.left.slice(e,t):e>=n?this.right.slice(e-n,t-n):this.left.slice(e,n).append(this.right.slice(0,t-n))},t.prototype.leafAppend=function(e){var n=this.right.leafAppend(e);if(n)return new t(this.left,n)},t.prototype.leafPrepend=function(e){var n=this.left.leafPrepend(e);if(n)return new t(n,this.right)},t.prototype.appendInner=function(e){return this.left.depth>=Math.max(this.right.depth,e.depth)+1?new t(this.left,new t(this.right,e)):new t(this,e)},t}(f);class y{constructor(e,t){this.items=e,this.eventCount=t}popEvent(e,t){if(0==this.eventCount)return null;let n,o,i=this.items.length;for(;;i--){if(this.items.get(i-1).selection){--i;break}}t&&(n=this.remapping(i,this.items.length),o=n.maps.length);let r,s,a=e.tr,l=[],h=[];return this.items.forEach((e,t)=>{if(!e.step)return n||(n=this.remapping(i,t+1),o=n.maps.length),o--,void h.push(e);if(n){h.push(new w(e.map));let t,i=e.step.map(n.slice(o));i&&a.maybeStep(i).doc&&(t=a.mapping.maps[a.mapping.maps.length-1],l.push(new w(t,void 0,void 0,l.length+h.length))),o--,t&&n.appendMap(t,o)}else a.maybeStep(e.step);return e.selection?(r=n?e.selection.map(n.slice(o)):e.selection,s=new y(this.items.slice(0,i).append(h.reverse().concat(l)),this.eventCount-1),!1):void 0},this.items.length,0),{remaining:s,transform:a,selection:r}}addTransform(e,t,n,o){let i=[],r=this.eventCount,s=this.items,a=!o&&s.length?s.get(s.length-1):null;for(let h=0;h<e.steps.length;h++){let n,l=e.steps[h].invert(e.docs[h]),p=new w(e.mapping.maps[h],l,t);(n=a&&a.merge(p))&&(p=n,h?i.pop():s=s.slice(0,s.length-1)),i.push(p),t&&(r++,t=void 0),o||(a=p)}let l=r-n.depth;return l>M&&(s=function(e,t){let n;return e.forEach((e,o)=>{if(e.selection&&0==t--)return n=o,!1}),e.slice(n)}(s,l),r-=l),new y(s.append(i),r)}remapping(e,t){let n=new l;return this.items.forEach((t,o)=>{let i=null!=t.mirrorOffset&&o-t.mirrorOffset>=e?n.maps.length-t.mirrorOffset:void 0;n.appendMap(t.map,i)},e,t),n}addMaps(e){return 0==this.eventCount?this:new y(this.items.append(e.map(e=>new w(e))),this.eventCount)}rebased(e,t){if(!this.eventCount)return this;let n=[],o=Math.max(0,this.items.length-t),i=e.mapping,r=e.steps.length,s=this.eventCount;this.items.forEach(e=>{e.selection&&s--},o);let a=t;this.items.forEach(t=>{let o=i.getMirror(--a);if(null==o)return;r=Math.min(r,o);let l=i.maps[o];if(t.step){let r=e.steps[o].invert(e.docs[o]),h=t.selection&&t.selection.map(i.slice(a+1,o));h&&s++,n.push(new w(l,r,h))}else n.push(new w(l))},o);let l=[];for(let d=t;d<r;d++)l.push(new w(i.maps[d]));let h=this.items.slice(0,o).append(l).append(n),p=new y(h,s);return p.emptyItemCount()>500&&(p=p.compress(this.items.length-n.length)),p}emptyItemCount(){let e=0;return this.items.forEach(t=>{t.step||e++}),e}compress(e=this.items.length){let t=this.remapping(0,e),n=t.maps.length,o=[],i=0;return this.items.forEach((r,s)=>{if(s>=e)o.push(r),r.selection&&i++;else if(r.step){let e=r.step.map(t.slice(n)),s=e&&e.getMap();if(n--,s&&t.appendMap(s,n),e){let a=r.selection&&r.selection.map(t.slice(n));a&&i++;let l,h=new w(s.invert(),e,a),p=o.length-1;(l=o.length&&o[p].merge(h))?o[p]=l:o.push(h)}}else r.map&&n--},this.items.length,0),new y(f.from(o.reverse()),i)}}y.empty=new y(f.empty,0);class w{constructor(e,t,n,o){this.map=e,this.step=t,this.selection=n,this.mirrorOffset=o}merge(e){if(this.step&&e.step&&!e.selection){let t=e.step.merge(this.step);if(t)return new w(t.getMap().invert(),t,this.selection)}}}class C{constructor(e,t,n,o,i){this.done=e,this.undone=t,this.prevRanges=n,this.prevTime=o,this.prevComposition=i}}const M=20;function b(e){let t=[];for(let n=e.length-1;n>=0&&0==t.length;n--)e[n].forEach((e,n,o,i)=>t.push(o,i));return t}function P(e,t){if(!e)return null;let n=[];for(let o=0;o<e.length;o+=2){let i=t.map(e[o],1),r=t.map(e[o+1],-1);i<=r&&n.push(i,r)}return n}let E=!1,T=null;function I(e){let t=e.plugins;if(T!=t){E=!1,T=t;for(let e=0;e<t.length;e++)if(t[e].spec.historyPreserveItems){E=!0;break}}return E}const O=new a("history"),S=new a("closeHistory");function x(e={}){return e={depth:e.depth||100,newGroupDelay:e.newGroupDelay||500},new r({key:O,state:{init:()=>new C(y.empty,y.empty,null,0,-1),apply:(t,n,o)=>function(e,t,n,o){let i,r=n.getMeta(O);if(r)return r.historyState;n.getMeta(S)&&(e=new C(e.done,e.undone,null,0,-1));let s=n.getMeta("appendedTransaction");if(0==n.steps.length)return e;if(s&&s.getMeta(O))return s.getMeta(O).redo?new C(e.done.addTransform(n,void 0,o,I(t)),e.undone,b(n.mapping.maps),e.prevTime,e.prevComposition):new C(e.done,e.undone.addTransform(n,void 0,o,I(t)),null,e.prevTime,e.prevComposition);if(!1===n.getMeta("addToHistory")||s&&!1===s.getMeta("addToHistory"))return(i=n.getMeta("rebased"))?new C(e.done.rebased(n,i),e.undone.rebased(n,i),P(e.prevRanges,n.mapping),e.prevTime,e.prevComposition):new C(e.done.addMaps(n.mapping.maps),e.undone.addMaps(n.mapping.maps),P(e.prevRanges,n.mapping),e.prevTime,e.prevComposition);{let i=n.getMeta("composition"),r=0==e.prevTime||!s&&e.prevComposition!=i&&(e.prevTime<(n.time||0)-o.newGroupDelay||!function(e,t){if(!t)return!1;if(!e.docChanged)return!0;let n=!1;return e.mapping.maps[0].forEach((e,o)=>{for(let i=0;i<t.length;i+=2)e<=t[i+1]&&o>=t[i]&&(n=!0)}),n}(n,e.prevRanges)),a=s?P(e.prevRanges,n.mapping):b(n.mapping.maps);return new C(e.done.addTransform(n,r?t.selection.getBookmark():void 0,o,I(t)),y.empty,a,n.time,null==i?e.prevComposition:i)}}(n,o,t,e)},config:e,props:{handleDOMEvents:{beforeinput(e,t){let n=t.inputType,o="historyUndo"==n?A:"historyRedo"==n?R:null;return!(!o||!e.editable)&&(t.preventDefault(),o(e.state,e.dispatch))}}}})}function z(e,t){return(n,o)=>{let i=O.getState(n);if(!i||0==(e?i.undone:i.done).eventCount)return!1;if(o){let r=function(e,t,n){let o=I(t),i=O.get(t).spec.config,r=(n?e.undone:e.done).popEvent(t,o);if(!r)return null;let s=r.selection.resolve(r.transform.doc),a=(n?e.done:e.undone).addTransform(r.transform,t.selection.getBookmark(),i,o),l=new C(n?a:r.remaining,n?r.remaining:a,null,0,-1);return r.transform.setSelection(s).setMeta(O,{redo:n,historyState:l})}(i,n,e);r&&o(t?r.scrollIntoView():r)}return!0}}const A=z(!1,!0),R=z(!0,!0);var V=e.create({name:"characterCount",addOptions:()=>({limit:null,mode:"textSize",textCounter:e=>e.length,wordCounter:e=>e.split(" ").filter(e=>""!==e).length}),addStorage:()=>({characters:()=>0,words:()=>0}),onBeforeCreate(){this.storage.characters=e=>{const t=(null==e?void 0:e.node)||this.editor.state.doc;if("textSize"===((null==e?void 0:e.mode)||this.options.mode)){const e=t.textBetween(0,t.content.size,void 0," ");return this.options.textCounter(e)}return t.nodeSize},this.storage.words=e=>{const t=(null==e?void 0:e.node)||this.editor.state.doc,n=t.textBetween(0,t.content.size," "," ");return this.options.wordCounter(n)}},addProseMirrorPlugins(){let e=!1;return[new r({key:new a("characterCount"),appendTransaction:(t,n,o)=>{if(e)return;const i=this.options.limit;if(null==i||0===i)return void(e=!0);const r=this.storage.characters({node:o.doc});if(r>i){const t=0,n=r-i;console.warn(`[CharacterCount] Initial content exceeded limit of ${i} characters. Content was automatically trimmed.`);const s=o.tr.deleteRange(t,n);return e=!0,s}e=!0},filterTransaction:(e,t)=>{const n=this.options.limit;if(!e.docChanged||0===n||null==n)return!0;const o=this.storage.characters({node:t.doc}),i=this.storage.characters({node:e.doc});if(i<=n)return!0;if(o>n&&i>n&&i<=o)return!0;if(o>n&&i>n&&i>o)return!1;if(!e.getMeta("paste"))return!1;const r=e.selection.$head.pos,s=r-(i-n),a=r;e.deleteRange(s,a);return!(this.storage.characters({node:e.doc})>n)}})]}}),k=e.create({name:"dropCursor",addOptions:()=>({color:"currentColor",width:1,class:void 0}),addProseMirrorPlugins(){return[c(this.options)]}}),_=e.create({name:"focus",addOptions:()=>({className:"has-focus",mode:"all"}),addProseMirrorPlugins(){return[new r({key:new a("focus"),props:{decorations:({doc:e,selection:t})=>{const{isEditable:n,isFocused:o}=this.editor,{anchor:i}=t,r=[];if(!n||!o)return h.create(e,[]);let s=0;"deepest"===this.options.mode&&e.descendants((e,t)=>{if(e.isText)return;if(!(i>=t&&i<=t+e.nodeSize-1))return!1;s+=1});let a=0;return e.descendants((e,t)=>{if(e.isText)return!1;if(!(i>=t&&i<=t+e.nodeSize-1))return!1;a+=1;if("deepest"===this.options.mode&&s-a>0||"shallowest"===this.options.mode&&a>1)return"deepest"===this.options.mode;r.push(p.node(t,t+e.nodeSize,{class:this.options.className}))}),h.create(e,r)}}})]}}),D=e.create({name:"gapCursor",addProseMirrorPlugins:()=>[d()],extendNodeSchema(e){var o;const i={name:e.name,options:e.options,storage:e.storage};return{allowGapCursor:null!=(o=t(n(e,"allowGapCursor",i)))?o:null}}}),N="placeholder";function j(e){return e.replace(/\s+/g,"-").replace(/[^a-zA-Z0-9-]/g,"").replace(/^[0-9-]+/,"").replace(/^-+/,"").toLowerCase()}var B=e.create({name:"placeholder",addOptions:()=>({emptyEditorClass:"is-editor-empty",emptyNodeClass:"is-empty",dataAttribute:N,placeholder:"Write something …",showOnlyWhenEditable:!0,showOnlyCurrent:!0,includeChildren:!1}),addProseMirrorPlugins(){const e=this.options.dataAttribute?`data-${j(this.options.dataAttribute)}`:`data-${N}`;return[new r({key:new a("placeholder"),props:{decorations:({doc:t,selection:n})=>{const i=this.editor.isEditable||!this.options.showOnlyWhenEditable,{anchor:r}=n,s=[];if(!i)return null;const a=this.editor.isEmpty;return t.descendants((t,n)=>{const i=r>=n&&r<=n+t.nodeSize,l=!t.isLeaf&&o(t);if((i||!this.options.showOnlyCurrent)&&l){const o=[this.options.emptyNodeClass];a&&o.push(this.options.emptyEditorClass);const r=p.node(n,n+t.nodeSize,{class:o.join(" "),[e]:"function"==typeof this.options.placeholder?this.options.placeholder({editor:this.editor,node:t,pos:n,hasAnchor:i}):this.options.placeholder});s.push(r)}return this.options.includeChildren}),h.create(t,s)}}})]}}),G=e.create({name:"selection",addOptions:()=>({className:"selection"}),addProseMirrorPlugins(){const{editor:e,options:t}=this;return[new r({key:new a("selection"),props:{decorations:n=>n.selection.empty||e.isFocused||!e.isEditable||i(n.selection)||e.view.dragging?null:h.create(n.doc,[p.inline(n.selection.from,n.selection.to,{class:t.className})])}})]}});function L({types:e,node:t}){return t&&Array.isArray(e)&&e.includes(t.type)||(null==t?void 0:t.type)===e}var H=e.create({name:"trailingNode",addOptions:()=>({node:void 0,notAfter:[]}),addProseMirrorPlugins(){var e;const t=new a(this.name),n=this.options.node||(null==(e=this.editor.schema.topNodeType.contentMatch.defaultType)?void 0:e.name)||"paragraph",o=Object.entries(this.editor.schema.nodes).map(([,e])=>e).filter(e=>(this.options.notAfter||[]).concat(n).includes(e.name));return[new r({key:t,appendTransaction:(e,o,i)=>{const{doc:r,tr:s,schema:a}=i,l=t.getState(i),h=r.content.size,p=a.nodes[n];if(l)return s.insert(h,p.create())},state:{init:(e,t)=>!L({node:t.tr.doc.lastChild,types:o}),apply:(e,t)=>{if(!e.docChanged)return t;if(e.getMeta("__uniqueIDTransaction"))return t;return!L({node:e.doc.lastChild,types:o})}}})]}}),W=e.create({name:"undoRedo",addOptions:()=>({depth:100,newGroupDelay:500}),addCommands:()=>({undo:()=>({state:e,dispatch:t})=>A(e,t),redo:()=>({state:e,dispatch:t})=>R(e,t)}),addProseMirrorPlugins(){return[x(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-я":()=>this.editor.commands.undo(),"Shift-Mod-я":()=>this.editor.commands.redo()}}});const F=/* @__PURE__ */Object.freeze(/* @__PURE__ */Object.defineProperty({__proto__:null,CharacterCount:V,Dropcursor:k,Focus:_,Gapcursor:D,Placeholder:B,Selection:G,TrailingNode:H,UndoRedo:W,preparePlaceholderAttribute:j},Symbol.toStringTag,{value:"Module"}));export{V as C,k as D,F as E,_ as F,D as G,B as P,G as S,H as T,W as U,j as p};
